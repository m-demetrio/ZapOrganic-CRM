<div class="app-shell">
  <div class="app">
    <header class="hero">
    <div class="hero__brand">
      <img class="hero__logo" src="/logo-zaporganic.png" alt="ZapOrganic" />
      <div>
        <div class="hero__title">ZapOrganic</div>
        <div class="hero__subtitle">Configuracoes do CRM</div>
      </div>
    </div>
    <div class="hero__meta">
      <span class="status-pill" id="zop-status" aria-live="polite">Pronto</span>
      <span class="status-pill status-pill--ghost">MVP 0.2</span>
    </div>
  </header>
  <p class="hero__tagline">
    Organize funis, respostas rapidas e integracoes com drag & drop, uploads e etiquetas do WhatsApp Business.
  </p>

  <div class="layout">
    <nav class="tabs" aria-label="Secoes">
      <button class="tab is-active" type="button" data-panel="funis">Funis</button>
      <button class="tab" type="button" data-panel="respostas">Respostas rapidas</button>
      <button class="tab" type="button" data-panel="integracoes">Integracoes</button>
      <button class="tab" type="button" data-panel="backups">Backups</button>
    </nav>

    <main class="panels">
      <section class="panel is-active" data-panel="funis">
        <div class="panel__header">
          <div>
            <div class="panel__title">Funis</div>
            <div class="panel__subtitle">Crie funis com etapas de texto, delay, tags e webhook.</div>
          </div>
          <div class="panel__header-actions">
            <label class="panel__search" title="Pesquisar funis">
              <span class="sr-only">Pesquisar funis</span>
              <input
                class="input input--small panel__search-input"
                id="zop-funnel-search"
                type="search"
                placeholder="Pesquisar funis..."
              />
            </label>
            <button class="button" id="zop-new-funnel" type="button">+ Novo funil</button>
          </div>
        </div>
        <p class="panel__note">
          Dica: clique em uma etapa para visualizar no preview. As alteracoes sao salvas automaticamente.
        </p>

        <div class="funnels-workspace" id="zop-funnels-workspace">
          <!-- Coluna 1: Lista de funis -->
          <div class="card funnels-col funnels-col--list">
            <div class="card__header card__header--tight">
              <div>
                <div class="card__title">Funis</div>
                <div class="card__subtitle">Selecione um funil para editar.</div>
              </div>
              <button class="icon-button icon-button--solid" id="zop-new-funnel-mini" type="button" aria-label="Criar novo funil">+</button>
            </div>

            <div class="list list--scroll" id="zop-funnel-list"></div>
            <div class="empty" id="zop-funnel-empty">
              <div class="empty__title">Nenhum funil cadastrado</div>
              <div class="empty__text">Crie um funil para comecar.</div>
            </div>

            <div class="card__footer">
              <button class="button button--wide" id="zop-new-funnel-secondary" type="button">+ Criar novo funil</button>
            </div>
          </div>

          <!-- Coluna 2: Editor -->
          <div class="card funnels-col funnels-col--editor" id="zop-funnel-editor">
            <div class="card__header">
              <div>
                <div class="card__title" id="zop-funnel-editor-title">Novo funil</div>
                <div class="card__subtitle">Edite os campos e organize as etapas.</div>
              </div>
            </div>

            <div class="card__body">
              <div class="field-grid field-grid--two">
                <label class="field">
                  <span>Nome</span>
                  <input class="input" id="zop-funnel-name" type="text" placeholder="Ex: Funil de boas-vindas" />
                </label>
                <label class="field">
                  <span>Descricao</span>
                  <textarea class="input input--area" id="zop-funnel-description" rows="2" placeholder="Ex: Primeiro atendimento + oferta"></textarea>
                </label>
              </div>

              <div class="section">
                <div class="section__header">
                  <div class="section__title">Etapas</div>
                  <button class="button button--ghost" id="zop-add-step" type="button">+ Nova etapa</button>
                </div>

                <div class="empty empty--inline" id="zop-steps-empty">
                  <div class="empty__title">Sem etapas</div>
                  <div class="empty__text">Clique em “+ Nova etapa” para adicionar a primeira etapa.</div>
                </div>

                <div class="steps steps--accordion" id="zop-steps-list"></div>
              </div>
            </div>

            <div class="card__footer card__footer--split">
              <div class="save-indicator" id="zop-funnel-save-indicator" aria-live="polite">Salvo &#10003;</div>
              <div class="footer-actions">
                <button class="button button--ghost" id="zop-duplicate-funnel" type="button">Duplicar</button>
                <button class="button button--danger" id="zop-delete-funnel" type="button">Excluir</button>
                <button class="button button--primary" id="zop-execute-funnel" type="button">Executar no chat</button>
                <!-- Mantido para compatibilidade (nao expor na UI) -->
                <button class="sr-only" id="zop-save-funnel" type="button">Salvar</button>
              </div>
            </div>
          </div>

          <!-- Coluna 3: Preview WhatsApp -->
          <div class="card funnels-col funnels-col--preview">
            <div class="wa-preview">
              <div class="wa-preview__header">
                <div class="wa-preview__avatar" aria-hidden="true"></div>
                <div class="wa-preview__meta">
                  <div class="wa-preview__title">ZapOrganic</div>
                  <div class="wa-preview__subtitle">Online</div>
                </div>
              </div>

              <div class="wa-preview__body">
                <div class="wa-preview__hint" id="zop-funnel-preview-hint">Selecione uma etapa para ver o preview.</div>
                <div class="wa-preview__chat" id="zop-funnel-preview-chat"></div>
              </div>

              <div class="wa-preview__composer" aria-hidden="true">
                <div class="wa-preview__composer-pill">Mensagem…</div>
                <div class="wa-preview__composer-btn">▶</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="respostas">
        <div class="panel__header">
          <div>
            <div class="panel__title">Respostas rapidas</div>
            <div class="panel__subtitle">Organize mensagens por categoria e variaveis.</div>
          </div>
          <button class="button" id="zop-new-quickreply" type="button">Nova resposta</button>
        </div>
        <p class="panel__note">
          Audio PTT, imagens, videos e arquivos (PDF, DOCX, XLSX) podem ser enviados com legenda e etiquetas do WhatsApp Business.
        </p>
        <div class="grid grid--two">
          <div class="card">
            <div class="card__header">
              <div>
                <div class="card__title">Lista de respostas</div>
                <div class="card__subtitle">Clique para editar.</div>
              </div>
            </div>
            <div class="list" id="zop-quickreply-list"></div>
            <div class="empty" id="zop-quickreply-empty">
              <div class="empty__title">Nenhuma resposta cadastrada</div>
              <div class="empty__text">Crie uma resposta rapida para reutilizar.</div>
            </div>
          </div>

          <div class="card">
            <div class="card__header">
              <div>
                <div class="card__title">Editor de resposta</div>
                <div class="card__subtitle" id="zop-quickreply-editor-title">Nova resposta</div>
              </div>
              <div class="card__actions">
                <button class="button button--ghost" id="zop-delete-quickreply" type="button" disabled>
                  Excluir
                </button>
                <button class="button" id="zop-save-quickreply" type="button">Salvar</button>
              </div>
            </div>

            <div class="form">
              <label class="field">
                <span>Categoria</span>
                <input
                  class="input"
                  id="zop-quickreply-category"
                  type="text"
                  placeholder="Ex: Boas-vindas"
                />
              </label>
              <label class="field">
                <span>Titulo</span>
                <input class="input" id="zop-quickreply-title" type="text" placeholder="Ex: Primeiro contato" />
              </label>
              <label class="field">
                <span>Tipo</span>
                <select class="input" id="zop-quickreply-type">
                  <option value="text">Texto</option>
                  <option value="audio">Audio</option>
                  <option value="ptt">PTT (gravado)</option>
                  <option value="ptv">PTV (video recado)</option>
                  <option value="image">Imagem</option>
                  <option value="video">Video</option>
                  <option value="file">Arquivo</option>
                </select>
              </label>
              <p class="quickreply__hint">Escolha o tipo e configure o arquivo local.</p>
              <label class="field">
                <span>Mensagem</span>
                <textarea
                  class="input input--area"
                  id="zop-quickreply-message"
                  rows="5"
                  placeholder="Digite a resposta rapida"
                ></textarea>
              </label>
              <label class="field">
                <span>Variaveis (separe por virgula)</span>
                <input class="input" id="zop-quickreply-variables" type="text" placeholder="Ex: nome, empresa" />
              </label>

              <div class="quickreply-media" id="zop-quickreply-media">
                <div class="field-grid">
                  <label class="field quickreply-media__field quickreply-media__field--file">
                    <span>Upload (mp3, mp4, png, pdf, docx)</span>
                    <input
                      class="input"
                      id="zop-quickreply-media-file"
                      type="file"
                      accept="audio/*,video/*,image/*,.pdf,.doc,.docx,.xls,.xlsx"
                    />
                    <span class="media__file-label" id="zop-quickreply-media-file-label">Nenhum arquivo selecionado</span>
                  </label>
                  <label class="field quickreply-media__field quickreply-media__field--caption">
                    <span>Legenda (opcional)</span>
                    <textarea
                      class="input input--area input--caption"
                      id="zop-quickreply-media-caption"
                      rows="4"
                      placeholder="Legenda"
                    ></textarea>
                  </label>
                  <label class="field">
                    <span>Nome exibido</span>
                    <input class="input" id="zop-quickreply-file-name" type="text" placeholder="documento.pdf" />
                  </label>
                </div>
                <p class="muted quickreply-media__hint">MP3, PTT gravado, videos, imagens e arquivos do WhatsApp Business são suportados.</p>
              </div>

              <label class="field">
                <span>Etiquetas WhatsApp Business (separe por virgula)</span>
                <input
                  class="input"
                  id="zop-quickreply-business-tags"
                  type="text"
                  placeholder="Ex: marketing, auto_reply"
                />
              </label>
            </div>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="integracoes">
        <div class="panel__header">
          <div>
            <div class="panel__title">Integracoes</div>
            <div class="panel__subtitle">Configure o webhook do n8n e segredos.</div>
          </div>
          <button class="button" id="zop-save-integrations" type="button">Salvar</button>
        </div>
        <div class="card">
          <div class="form">
            <label class="field">
              <span>URL do webhook n8n</span>
              <input class="input" id="zop-n8n-url" type="url" placeholder="https://..." />
            </label>
            <label class="field">
              <span>Secret do webhook</span>
              <input class="input" id="zop-n8n-secret" type="password" placeholder="Opcional" />
            </label>
            <label class="toggle">
              <input id="zop-enable-webhook" type="checkbox" />
              <span class="toggle__track"></span>
              <span class="toggle__label">Ativar envio de webhook</span>
            </label>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="backups">
        <div class="panel__header">
          <div>
            <div class="panel__title">Backups</div>
            <div class="panel__subtitle">Exporte ou importe funis, respostas e integracoes.</div>
          </div>
        </div>
        <div class="grid grid--two">
          <div class="card">
            <div class="card__header">
              <div>
                <div class="card__title">Exportar configuracoes</div>
                <div class="card__subtitle">Gera um JSON com todos os dados.</div>
              </div>
              <button class="button" id="zop-export-backup" type="button">Exportar JSON</button>
            </div>
            <div class="card__body">
              <p class="muted">Guarde o arquivo para restaurar depois.</p>
            </div>
          </div>
          <div class="card">
            <div class="card__header">
              <div>
                <div class="card__title">Importar configuracoes</div>
                <div class="card__subtitle">Substitui dados atuais.</div>
              </div>
              <button class="button button--ghost" id="zop-import-backup-trigger" type="button">
                Selecionar arquivo
              </button>
            </div>
            <div class="card__body">
              <p class="muted">O JSON deve ter funis, respostas e integracoes.</p>
              <input id="zop-import-backup" type="file" accept="application/json" hidden />
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

